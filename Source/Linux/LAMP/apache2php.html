<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Apache 2 and PHP 5 (mod_php) on Linux</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<meta name="description" content="Guide on building and installing PHP with Apache 2 webserver software from source." />
<meta name="keywords" content="Apache 2, Apache2, PHP, installation" />
<link rel="shortcut icon" href="favicon.ico" />
<link rel="icon" href="favicon.png" type="image/png" />
<link rel="stylesheet" type="text/css" href="/style.css" />
</head>

<body>

<h1>Apache 2 and PHP 5 (mod_php) on Linux
<a href="http://www.php.net/">
<img src="images/php.png" width="120" height="64" align="middle" border="0"
 alt="php logo"></a>
<a href="http://httpd.apache.org/">
<img src="/icons/apache_pb.png" width="259" height="32" border="0" align="middle" alt="Powered by Apache logo"></a>
</h1>


<p>
<!--begin, bannerad.h-->

<table bgcolor="#ffffcc" border="0" width="500" height="60" align="center">
<tr>
<td align="center">
	<a href="http://calhotels.us/">
	<img src="/images/hotelicon.png" width="54" height="43"
	 align="left" border="0" alt="CalHotels.US--online reservations now" /></a>
	<span style="font-family: arial,helvetica,univers,verdana,geneva,sans-serif">
	<a href="http://calhotels.us/" style="text-decoration: none;">
	<b>CalHotels.US</b></a>
	<span style="font-size: larger"><b>Lowest Hotel Rates Guaranteed.</b></span>
	<a href="http://calhotels.us/" style="text-decoration: none;">
	Click Here For Yours!</a></span>

	<br />
	<span style="font-size: xx-small; font-family: arial,helvetica,univers,verdana,geneva,sans-serif">
	U.S. states:
<a href="http://calhotels.us/alabama/" title="Alabama Hotels">AL</a>,
<a href="http://calhotels.us/alaska/" title="Alaska Hotels">AK</a>,
<a href="http://calhotels.us/arkansas/" title="Arkansas Hotels">AR</a>,
<a href="http://calhotels.us/pacific-islands/american-samoa.html" title="American Samoa Hotels">AS</a>,
<a href="http://calhotels.us/arizona/" title="Arizona Hotels">AZ</a>,
<a href="http://calhotels.us/california/" title="California Hotels">CA</a>,
<a href="http://calhotels.us/colorado/" title="Colorado Hotels">CO</a>,
<a href="http://calhotels.us/connecticut/" title="Connecticut Hotels">CT</a>,
<a href="http://calhotels.us/district-of-columbia/washington.html" title="District of Columbia Hotels">DC</a>,
<a href="http://calhotels.us/delaware/" title="Delaware Hotels">DE</a>,
<a href="http://calhotels.us/florida/" title="Florida Hotels">FL</a>,
<a href="http://calhotels.us/pacific-islands/micronesia.html" title="Micronesia Hotels">FM</a>,
<a href="http://calhotels.us/georgia/" title="Georgia Hotels">GA</a>,
<a href="http://calhotels.us/pacific-islands/guam.html" title="Guam Hotels">GU</a>,
<a href="http://calhotels.us/hawaii/" title="Hawaii Hotels">HI</a>,
<a href="http://calhotels.us/idaho/" title="Idaho Hotels">ID</a>,
<a href="http://calhotels.us/illinois/" title="Illinois Hotels">IL</a>,
<a href="http://calhotels.us/indiana/" title="Indiana Hotels">IN</a>,
<a href="http://calhotels.us/iowa/" title="Iowa Hotels">IA</a>,
<a href="http://calhotels.us/kansas/" title="Kansas Hotels">KS</a>,
<a href="http://calhotels.us/kentucky/" title="Kentucky Hotels">KY</a>,
<a href="http://calhotels.us/louisiana/" title="Louisiana Hotels">LA</a>,
<a href="http://calhotels.us/maine/" title="Maine Hotels">ME</a>,
<a href="http://calhotels.us/maryland/" title="Maryland Hotels">MD</a>,
<a href="http://calhotels.us/massachusetts/" title="Massachusetts Hotels">MA</a>,
<a href="http://calhotels.us/michigan/" title="Michigan Hotels">MI</a>,
<a href="http://calhotels.us/minnesota/" title="Minnesota Hotels">MN</a>,
<a href="http://calhotels.us/mississippi/" title="Mississippi Hotels">MS</a>,
<a href="http://calhotels.us/missouri/" title="Missouri Hotels">MO</a>,
<a href="http://calhotels.us/montana/" title="Montana Hotels">MT</a>,
<a href="http://calhotels.us/nebraska/" title="Nebraska Hotels">NE</a>,
<a href="http://calhotels.us/new-hampshire/" title="New Hampshire Hotels">NH</a>,
<a href="http://calhotels.us/new-jersey/" title="New Jersey Hotels">NJ</a>,
<a href="http://calhotels.us/new-york/" title="New York Hotels">NY</a>,
<a href="http://calhotels.us/oklahoma/" title="Oklahoma Hotels">OK</a>,
<a href="http://calhotels.us/nevada/" title="Nevada Hotels">NV</a>,
<a href="http://calhotels.us/pacific-islands/marshall-islands.html" title="Marshall Islands Hotels">MH</a>,
<a href="http://calhotels.us/pacific-islands/mariana-islands.html" title="Marianas Hotels">MP</a>,
<a href="http://calhotels.us/new-mexico/" title="New Mexico Hotels">NM</a>,
<a href="http://calhotels.us/north-carolina/" title="North Carolina Hotels">NC</a>,
<a href="http://calhotels.us/north-dakota/" title="North Dakota Hotels">ND</a>,
<a href="http://calhotels.us/ohio/" title="Ohio Hotels">OH</a>,
<a href="http://calhotels.us/oregon/" title="Oregon Hotels">OR</a>,
<a href="http://calhotels.us/pennsylvania/" title="Pennsylvania Hotels">PA</a>,
<a href="http://calhotels.us/puerto-rico/" title="Puerto Rico Hotels">PR</a>,
<a href="http://calhotels.us/pacific-islands/palau.html" title="Palau Hotels">PW</a>,
<a href="http://calhotels.us/rhode-island/" title="Rhode Island Hotels">RI</a>,
<a href="http://calhotels.us/south-carolina/" title="South Carolina Hotels">SC</a>,
<a href="http://calhotels.us/south-dakota/" title="South Dakota Hotels">SD</a>,
<a href="http://calhotels.us/tennessee/" title="Tennessee Hotels">TN</a>,
<a href="http://calhotels.us/texas/" title="Texas Hotels">TX</a>,
<a href="http://calhotels.us/utah/" title="Utah Hotels">UT</a>,
<a href="http://calhotels.us/vermont/" title="Vermont Hotels">VT</a>,
<a href="http://calhotels.us/virginia/" title="Virginia Hotels">VA</a>,
<a href="http://calhotels.us/virgin-islands/" title="US Virgin Islands Hotels">VI</a>
<a href="http://calhotels.us/washington/" title="Washington Hotels">WA</a>,
<a href="http://calhotels.us/west-virginia/" title="West Virginia Hotels">WV</a>,
<a href="http://calhotels.us/wisconsin/" title="Wisconsin Hotels">WI</a>,
<a href="http://calhotels.us/wyoming/" title="Wyoming Hotels">WY</a>
	</span>
</td>
</tr>
</table>

<!--end, bannerad.h-->

<?php include "bannerad.h"; ?>
</p>



<ul>
<li><a href="#installing">Apache 2 and PHP 5 Installation</a>
<li><a href="#tips">Tips and Notes</a>
<li><a href="#references">References</a>
</ul>

<h2>
<img src="images/php.png" width="90" height="48" align="middle" border="0"
 alt="php logo">
<a id="installing">Apache 2 and PHP Installation</a></h2>

<p>
The following notes are how I got Apache 2 and PHP 5
(or PHP 4)
working together on Linux.
These instructions also apply, mostly, for any UNIX-like system,
especially other Linux distributions.
If you have a recent Linux distribution (say since 2002),
you already have Apache 2 and PHP, so you don't need to
do this unless you want the latest Apache 2 or PHP release
or need to customize the Apache or PHP software.
Don't forget to remove (or at least disable) the Apache rpm package if you
install your own custom Apache.
</p>

<p>
<b>Apache 2 Version Tip:</b>
Beginning with Apache 2.0.42 the API will be kept stable (yeah!).
That means you will <b>NOT</b> have to recompile modules
(and possibly upgrade/fix source) every time you install a new Apache release.
This assumes you stay in the same Apache release series.
For example, upgrading from 2.2.0 to 2.2.2 should work.
This will not apply to upgrading to the next series
(e.g., "development" 2.3.x or "stable" 2.4.x).
</p>

<p>
I was only able to get PHP working with Apache 2 as a *.so DSO
("dynamic shared object"),
as opposed to compiled into Apache (with a static *.a library).
I think DSO is the only way PHP is supported now on Apache 2.
</p>

<p>
I first used httpd-2.0.43 and php-4.3.0 with RedHat 7.3.
I am now using
httpd-2.2.3
and
php-5.2.0
with
SUSE 10.1.
</p>

<blockquote>
Note: If you have problems with PHP and think it's a recent bug,
you may want to consider using the latest 
<a href="http://snaps.php.net/">http://snaps.php.net/</a> snapshot.
Beware that snapshots frequently have regression and are not for production use.
Usually problems are because of mis-configuration, not bugs, so snapshots
will probably <i>hurt more than help</i>.
</blockquote>

<p>
<ol>
<li>
Download/unpack Apache2 source from the
<a href="http://httpd.apache.org/">Apache httpd server
website, http://httpd.apache.org/</a>
<br /><br />
<li>
In the Apache 2 source directory, create a <tt>Makefile</tt> by typing:
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
./configure --prefix=/usr/local/apache \
	--enable-so	\
	--enable-cgi	\
	--enable-info	\
	--enable-rewrite	\
	--enable-speling	\
	--enable-usertrack	\
	--enable-deflate \
	--enable-ssl	\
	--enable-mime-magic
</pre>
</td>
</tr>
</table>
</blockquote>
You only need the <tt>enable-so</tt> line above.
For information on other options,
type <tt>./configure --help</tt>
and see
"Compiling and Installing"
in the
<a href="http://httpd.apache.org/">Apache 2 Documentation,
http://httpd.apache.org/</a>

<br /><br />
<li>
Make Apache from the just-created <tt>Makefile</tt>:
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
make
</pre>
</td>
</tr>
</table>
</blockquote>


<li>
If make is successful, install Apache as root:
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
make install
</pre>
</td>
</tr>
</table>
</blockquote>


<li>
Download/unpack PHP source from the
<a href="http://www.php.net/">PHP website, http://www.php.net/</a>
<br />Pick the latest from the 4.x series or 5.x series.


<br /><br />
<li>
In the PHP source directory, create a <tt>Makefile</tt> by typing:
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
./configure \
	--with-apxs2=/usr/local/apache/bin/apxs \
	--with-mysql \
	--prefix=/usr/local/apache/php \
	--with-config-file-path=/usr/local/apache/php \
	--enable-force-cgi-redirect \
	--disable-cgi \
	--with-zlib \
	--with-gettext \
	--with-gdbm
</pre>
</td>
</tr>
</table>
</blockquote>

You only need the <tt>--with-apxs2</tt>, and <tt>prefix</tt> lines.
<tt>--with-mysql</tt> adds MySql,
<tt>--with-config-file</tt> moves the php.ini file location,
<tt>disable-cgi</tt> disables the CGI version,
	which is not needed if you use Apache modules.
	It also enables and installs the command line interface (CLI) version.
<tt>--with-zlib</tt> allows use of gzip-type compression,
<tt>--with-gettext</tt> is for internationalization,
and
<tt>--with-gdbm</tt> allows access to GDBM databases.
For more information,
type <tt>./configure --help</tt>
and see the "Installation" chapter in the
<a href="http://www.php.net/docs.php"><i>PHP Manual</i>,
http://ww.php.net/docs.php</a>



<br /><br />
<li>
Make PHP from the just-created <tt>Makefile</tt>:
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
make
</pre>
</td>
</tr>
</table>
</blockquote>


<li>
If make is successful, type this as root to install PHP:
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
make install
</pre>
</td>
</tr>
</table>
</blockquote>


If you are not root
(I do not perform makes while root, for security and safety reasons),
become root and type the following:
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
make install-su
</pre>
</td>
</tr>
</table>
</blockquote>


<li>
If file <tt>/usr/local/apache/modules/libphp5.so</tt>
does not exist or is an older version, type this
(change this to <tt>libphp4.so</tt> for PHP 4):

<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
cp -p .libs/libphp5.so /usr/local/apache/modules
</pre>
</td>
</tr>
</table>
</blockquote>


<li>
Install the php.ini file:
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
cp -p php.ini-recommended /usr/local/apache/php/php.ini
</pre>
</td>
</tr>
</table>
</blockquote>


<li>
Add these directives are in
<tt>/usr/local/apache/conf/httpd.conf</tt>
(if already there, verify they are correct):

<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
# Make sure there's only **1** line for each of these 2 directives:
# Use for PHP 4.x:
#LoadModule php4_module        modules/libphp4.so
#AddHandler php-script   php

# Use for PHP 5.x:
LoadModule php5_module        modules/libphp5.so
AddHandler php5-script php 

# Add index.php to your DirectoryIndex line:
DirectoryIndex index.html index.php

AddType text/html       php

# PHP Syntax Coloring
# (optional but useful for reading PHP source for debugging):
AddType application/x-httpd-php-source phps

</pre>
</td>
</tr>
</table>
</blockquote>


<p>
<blockquote>
<p>
Note 1:
The php documentation recommends <tt>AddType application/x-httpd-php php</tt>
instead of the above. However, it causes problems with the "MultiViews" feature
of HTTP.
That is, if the .php extension is left off a URL, and with certain browser
<tt>Accept</tt> headers, Apache will not know .php
(<tt>application/x-httpd-php</tt>) is HTML and will return
a <tt>406 Not Acceptable</tt> error.
Using the <tt>AddType</tt> and <tt>AddHandler</tt> as shown above
fixes this problem.
For details see
Mark Tranchant's webpage,
"<a href="http://tranchant.plus.com/notes/multiviews">Using
Apache's MultiViews with PHP whilst avoid 406 errors</a>,"
and <a href="http://bugs.php.net/bug.php?id=28023">PHP bug 28023</a>.
</p>

<p>
Note 2:
PHP Syntax coloring isn't required,
but it's very nice for looking at your php source while debugging.
<a href="https://dan.drydog.com/loadcacert.phps">Here's an example</a>.
</p>

<p>
Note 3:
just for completeness
I'll mention that you should be able to use
<tt>SetOutputFilter</tt> / <tt>SetInputFilter</tt>
instead of <tt>AddType</tt>,
but you can't use both.
However, <tt>SetOutputFilter</tt> / <tt>SetInputFilter</tt>
no longer works for me.
It used to work with an earlier PHP 4.x or Apache 2 version,
but not with Apache 2.0.47/PHP 4.3.3.
I understand this (PHP as an Apache 2 filter) is experimental,
so I don't use it anymore:
</p>

<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
&lt;Files *.php&gt;
	SetOutputFilter PHP
	SetInputFilter  PHP
&lt;/Files&gt;
</pre>
</td>
</tr>
</table>
</blockquote>

</blockquote>


<li>
You're now ready to try it out.
Start Apache (httpd) as root:
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
/usr/local/apache/bin/apachectl start
</pre>
</td>
</tr>
</table>
</blockquote>


<li>
Perform these sanity checks to verify your install went OK:
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
$<b> /usr/local/apache/bin/httpd -t</b>
Syntax OK

$<b> /usr/local/apache/bin/httpd -v</b>
Server version: Apache/2.2.2
Server built:   May 29 2006 12:40:55


$<b> /usr/local/apache/bin/httpd -V</b>
Server version: Apache/2.2.2
Server built:   May 29 2006 12:40:55
Server's Module Magic Number: 20051115:2
Server loaded:  APR 1.2.7, APR-Util 1.2.7
Compiled using: APR 1.2.7, APR-Util 1.2.7
Architecture:   32-bit
Server MPM:     Prefork
  threaded:     no
    forked:     yes (variable process count)
Server compiled with....
 -D APACHE_MPM_DIR="server/mpm/prefork"
 -D APR_HAS_SENDFILE
 -D APR_HAS_MMAP
 -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
 -D APR_USE_SYSVSEM_SERIALIZE
 -D APR_USE_PTHREAD_SERIALIZE
 -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
 -D APR_HAS_OTHER_CHILD
 -D AP_HAVE_RELIABLE_PIPED_LOGS
 -D DYNAMIC_MODULE_LIMIT=128
 -D HTTPD_ROOT="/usr/local/apache"
 -D SUEXEC_BIN="/usr/local/apache/bin/suexec"
 -D DEFAULT_PIDLOG="logs/httpd.pid"
 -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
 -D DEFAULT_LOCKFILE="logs/accept.lock"
 -D DEFAULT_ERRORLOG="logs/error_log"
 -D AP_TYPES_CONFIG_FILE="conf/mime.types"
 -D SERVER_CONFIG_FILE="conf/httpd.conf"

$<b> /usr/local/apache/bin/httpd -S</b>
VirtualHost configuration:
. . .

$<b> /usr/local/apache/bin/httpd -l</b>
Compiled in modules:
  core.c
  . . .
  mod_so.c

$<b> /usr/local/apache/bin/httpd -M</b>
Loaded Modules:
. . .
 php5_module (shared)
Syntax OK

(the above works for Apache 2.2.x and higher only)

$<b> ps -ef |grep httpd</b>
root     24069     1  0 09:17 ?        00:00:08 /usr/local/apache/bin/httpd -k s
apache   29917 24069  0 15:30 ?        00:00:00 /usr/local/apache/bin/httpd -k s
. . .

</pre>
</td>
</tr>
</table>
</blockquote>

<p>
Note: on BSD-based UNIX systems, you need to use
"<tt>ps -aux</tt>" instead of "<tt>ps -ef</tt>".
</p>

<li>
Access your webserver with telnet.
Type <tt>HEAD / HTTP/1.0</tt> followed by a blank line:
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
$<b> telnet localhost 80</b>
Trying 127.0.0.1...
Connected to localhost (127.0.0.1).
Escape character is '^]'.
<b>HEAD / HTTP/1.0</b>

HTTP/1.1 200 OK
Date: Mon, 29 May 2006 23:28:18 GMT
Server: Apache/2.2.2 (Unix) mod_ssl/2.2.2 OpenSSL/0.9.7a PHP/5.1.4
X-Powered-By: PHP/5.1.4
Last-Modified: Wed, 15 Mar 2006 06:53:17 GMT
Vary: Accept-Encoding
Connection: close
Content-Type: text/html; charset=ISO-8859-1
Content-Language: en

Connection closed by foreign host.
</pre>
</td>
</tr>
</table>
</blockquote>


<li>
Access your webserver with your favorite browser.
The following is a good test page to use for PHP.
You only need the one line in <b>bold</b> is needed to display PHP configuration information.
Name the file anything you want, but it <b>must</b> end with <tt>.php</tt>, such as
<tt>phpinfo.php</tt>, and move the file to your web server content directory
(for me <tt>/usr/local/apache/htdocs</tt>), with read permission set:

<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;PHP Test&lt;/title&gt;
	&lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;h1&gt;PHP Test&lt;/h1&gt;
	&lt;p&gt;
	&lt;b&gt;An Example of PHP in Action&lt;/b&gt;&lt;br /&gt;
		&lt;?php echo "The Current Date and Time is: &lt;br&gt;";
			echo date("g:i A l, F j Y.");?&gt;
	&lt;/p&gt;

	&lt;h2&gt;PHP Information&lt;/h2&gt;
	&lt;p&gt;
		<b>&lt;?php phpinfo(); ?&gt;</b>
	&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
</td>
</tr>
</table>
</blockquote>
</ol>

<h2>
<img src="images/php.png" width="90" height="48" align="middle" border="0"
 alt="php logo">
<a id="tips">Tips and Notes</a></h2>


<p>
<b>
&bull;
Disabling Existing Apache Software</b>
</p>

<p>
If Apache is already installed with your Linux distribution
you have to disable it before installing your own custom version.
To do this, type the following under RedHat Linux:

<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
/sbin/chkconfig --del httpd
/etc/init.d/httpd stop
</pre>
</td>
</tr>
</table>
</blockquote>

You may also remove the <tt>httpd</tt> and <tt>php</tt> rpm packages,
and dependent packages, if you wish.
</p>

<p>
<b> &bull; Automatic Startup of Apache</b>
</p>

<p>
To start Apache automatically, follow these steps:
<ul>
<li>Copy Apache startup file to the startup directory:
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
cp /usr/local/apache/bin/apachectl /etc/init.d/
</pre>
</td>
</tr>
</table>
</blockquote>
</p>

<p>
<li>Edit <tt>/etc/init.d/apachectl</tt>
by inserting these 2 lines in <b>bold</b>:
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
#!/bin/sh
#
<b># chkconfig: - 85 15
# description: Apache is a Web server used to serve HTML files and CGI.</b>
#
# Copyright 2000-2005 The Apache Software Foundation or its licensors, as
# applicable.
. . .
# Apache control script designed to allow an easy command line interface
# to controlling Apache.  Written by Marc Slemko, 1997/08/23
. . .
</pre>
</td>
</tr>
</table>
</blockquote>


<li>Enable httpd to startup automatically:
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
/sbin/chkconfig --add apachectl
/sbin/chkconfig --level 2 apachectl on
</pre>
</td>
</tr>
</table>
</blockquote>

This works for RedHat Linux, Mandrake, SuSE, and Sun Java Desktop System.
The equivalent of <tt>chkconfig</tt> for Debian is:
<br />
<tt>update-rc.d apachectl defaults</tt>
<br />
For other distributions,
make appropriate softlinks to directories <tt>/etc/rc*.d/</tt>

<br /><br />
<li>
Reboot Linux to verify Apache starts
</ul>

<p>
[Thanks to Beriah Dutcher and others]
</p>

<p>
&bull;
<b><tt>Make</tt> doesn't make dynamic library <tt>libphp5.so</tt>,
just static library <tt>libphp5.a</tt></b>
</p>
<p>
First make sure libphp5.so isn't there.
It's usually in the libs or .libs subdirectory.
Run find from the PHP source directory root:
<tt>find . -name libphp5.so</tt>
If that doesn't work, make sure you use the <tt>--with-apxs2</tt>
option with the correct directory in <tt>./configure</tt>.  For example:
<br />
  <tt>./configure --with-mysql --with-apxs2=/path/to/apache/apxs</tt>
<br />
When re-running <tt>./configure</tt> always start with a fresh, clean
source directory (no object).
</p>

<p>
(For PHP 4, substitute
<tt>libphp4.so</tt> and <tt>libphp4.a</tt> for
<tt>libphp5.so</tt> and <tt>libphp5.a</tt>, respectively.)
</p>

<p>
&bull;
<b>PHP 5: My PHP scripts that worked with PHP 4 now ignores input variables</b>
</p>
<p>
If you have old PHP 4 scripts you don't want to convert to PHP 5,
change this line in your php.ini file:
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
register_long_arrays = On
</pre>
</td>
</tr>
</table>
</blockquote>
</p>

<p>
For the long term, you may want to upgrade your PHP software or convert the
PHP source code to use new-style variables.  E.g., 
use <tt>$_REQUEST[i]</tt> instead of <tt>$i</tt>
</p>

<p>
&bull;
<b>PHP 5.2.0 Upgrade from 5.1.x</b> (November 2006)
</p>
I had one problem with upgrading from PHP 5.1.x to 5.2.0.
The Phorum 3 software I use has a function <tt>date_format</tt>
that now conflicts with a new PHP 5.2 internal function, also called
<tt>date_format</tt>.
This new function is used for PHP 5.2.x's new "datetime support".
I fixed this by renaming Phorum's <tt>date_format</tt> function to not conflict with PHP's function.
See also 
<a href="http://www.php.net/UPDATE_5_2.txt">PHP 5.2 Update Info</a> for more
PHP 5.2 upgrade information.

<p>
&bull;
<b>PHP 5.x: you may need to upgrade libxml2 to use XML</b>
</p>
<p>
To use PHP 5 and XML (<tt>--with-xml</tt>),
you need the libxml2 library version 2.6.0 or greater.
You may need to upgrade if you have an older Linux distribution.
Check with <tt>rpm -q libxml2</tt>
<br />
If it's not installed, check your installation disks for the libxml2 package.
If it's too old, you can get the library from
<a href="http://www.xmlsoft.org/">XMLSoft.org</a>.
You will probably need to compile and install it yourself.
</p>



<p>
&bull;
<b>PHP 4.3.5 / 4.3.6 / 5.0RC1 PCRE Regression</b> (March 2004)
</p>

<p>
If you use PHP 4.3.5, 4.3.6, or PHP 5.0 RC1
with PCRE (Perl Regular Expressions, the default),
you get a core dump when you try and restart (SIGHUP) Apache
(at least with Apache 2.0.49).
The cause is from adding a new version of PCRE, 4.5, in PHP.
This is fixed in PHP 4.3.7 and 5.0.
</p>

<p>
The symptom are these messages in error_log
(which is also a symptom for lots of other memory-type bugs in Apache):
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
[Wed Mar 31 17:14:43 2004] [notice] SIGHUP received.  Attempting to restart
[Wed Mar 31 17:14:43 2004] [notice] seg fault or similar nasty error detected in the parent process
[Wed Mar 31 17:14:48 2004] [warn] pid file /var/run/httpd.pid overwritten -- Unclean shutdown of previous Apache run?
</pre>
</td>
</tr>
</table>
</blockquote>

<p>
To fix,
upgrade to PHP 4.3.7 or higher, which fixes it
	(PHP 5.0 or higher also fixes the bug).
A workaround is to stop/start Apache, instead of restarting Apache.
For details, see
<a href="http://bugs.php.net/bug.php?id=27810">
PHP bug 27810</a>.
</p>


<p> &bull; <b><tt>ServerRoot</tt> Installation Directory</b></p>

<p>
By default, Apache is installed in ServerRoot, as specified in httpd.conf
or the httpd -d option:
<br /><tt>ServerRoot "/usr/local/apache"</tt>
<br />Some packagers and distributions move the location to
<tt>/usr/local/httpd</tt>
or
<tt>/usr/local/apache2</tt>
so check that Apache is installed where you say it is,
and check that you don't have two separate Apache installations by mistake.
</p>

<p> &bull; <b>PHP-required Apache files must be present</b></p>

<p>
PHP expects certain files to be present.  They may be missing for
some Linux distributions, which tend to separate files among the
<tt>/var</tt>,
<tt>/etc</tt>,
and other directories.
The <tt>apxs</tt> program expects to find httpd under the <tt>bin</tt> directory
where apache is installed (by default <tt>/usr/local/apache/bin</tt>).
PHP expects to find the <tt>os.h</tt> and <tt>unixd.h</tt>
header files under the <tt>include</tt>
directory where apache is installed
(by default <tt>/usr/local/apache/include</tt>).


<p> &bull; <b>MySQL</b></p>
<p>
Use the
<tt>--with-mysql</tt> configure option
to build PHP with PHP's version of MySql.
If you want the system's MySQL, or are also using MySql with
another apache module (e.g., mod_perl), use this:
<tt>with-mysql=/usr</tt>
</p>

<p>&bull; <b>Custom OpenSSL and SSL</b></p>
<p>
When using "--enable-ssl" (i.e, build with OpenSSL),
the configure script will try to guess the location of OpenSSL.
If you're using your own custom SSL, you must specify the location.
For example,
"<tt>--with-ssl=/usr/local/ssl</tt>"
(of course, you can use the SSL and PHP that comes with Redhat 9
and other distributions).
</p>

<p>
Please note that mod_ssl is only for Apache 1.x.  Apache 2.x does not
use mod_ssl&mdash;SSL is built into Apache 2.x.
</p>

<p>
Jason reports that with RedHat 9 on his system, the make failed at
mod_ssl.  It needed a missing krb5.h header file.  The fix is to
Add an environment variable, $CFLAGS, before making PHP.  That is:
<br />
"<tt>-I/usr/kerberos/include/ -L/usr/kerberos/lib</tt>"
</p>

<p>
&bull;
<b>gdbm</b>
<br />
If you get this error when using "--with-gdbm":
<br />
<tt>configure: error: DBA: Could not find necessary header file(s).</tt>
<br />
then you are probably missing the gdbm-devel rpm package.
</p>

<p>
&bull;
<b>Apache 1.x and Apache 2 Configuration Directives</b>
<br />
The "<tt>AddModule</tt>,"
"<tt>AgentLog</tt>," "<tt>ReferrerLog</tt>," "<tt>RefererIgnore</tt>,"
"<tt>BindAddress</tt>," "<tt>ClearModuleList</tt>," "<tt>Port</tt>,"
"<tt>FancyIndexing</tt>,"
"<tt>ServerType</tt>," "<tt>AccessConfig</tt>,"
and
"<tt>ResourceConfig</tt>"
directives in Apache 1.x <b>no longer exist</b> in Apache 2.
Also, "<tt>HAVE_*</tt>" httpd.conf definitions no longer exist.
Comment them out of your httpd.conf for Apache 2.
Most of these directives have been replaced by other directive(s).
</p>

<p> &bull; <b>Error after glibc library upgrade</b></p>
<p>
Apache should still work after upgrading glibc with security and bug fixes
for the same release.  If you use another architecture (say from or to
i386/i686), you need to recompile.  One symptom is an error like this
in your Apache error_log:
<br />
<tt>[error] (38)Function not implemented:</tt>
</p>

<p> &bull; <b>make clean</b></p>
<p>
Kåre Olaussen adds this note:
If you're compiling php4 for both
Apache 1.3 and Apache 2, use a separate php source directory
for each version of Apache.
"The module wouldn't load into Apache 2, because
I had forgotten to run make clean in between."
[Ed. note: I recommend untaring the source from scratch in another directory,
that way you are sure no old state information is left behind from previous
makes.  Do this for any configuration or version changes.]
</p>

<p> &bull; <b>Enabling <tt>register_globals</tt> for Apache 2</b></p>
<p>
From Duke:
For those of you that are desperately trying to enable
<tt>register_globals</tt>
on a per-directory basis using Apache 2 with PHP 4 [or PHP 5]
using <tt>.htaccess</tt> files,
the syntax is different from Apache 1.x.
In the directory you want to enable <tt>register_globals</tt> (or pretty much
any other on/off setting), add an <tt>.htaccess</tt> file containing:
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
php_value register_globals 1
</pre>
</td>
</tr>
</table>
</blockquote>
Note that <tt>php_flag</tt> does <b>not</b> work with Apache 2.
Neither does <tt>on</tt> / <tt>off</tt>
 &mdash; you must use <tt>0</tt> (off) or <tt>1</tt> (on).
</p>

<p>
[Editor's note:
To enable globally, add <tt>register_globals=off</tt>
to your <tt>php.ini</tt> file.]
</p>

<p>
To enable <tt>register_globals</tt> on a per-directory basis,
you can add to a <tt>&lt;Directory&gt;</tt> stanza
or create a <tt>.htaccess</tt> configuration file in the directory.
To use <tt>.htaccess</tt>, you must first enable it by adding
<tt>AllowOverride All</tt> (or some combination of <tt>AllowOverride</tt>
options
within the correct <tt>&lt;Directory&gt;</tt> stanza.
Also newer PHP software, such as SquirrelMail, no longer require
<tt>register_globals</tt> to be enabled.
Keeping <tt>register_globals</tt> disalbed makes the system much more secure
(as it's harder to set internal php variables through submitting html forms).
]
</p>

</p>

<p> &bull; <b>Multi-Processing Module (MPM): don't use multi-threading MPMs</b></p>
<p>
MPMs is how Apache 2 handles multiple web server requests.
That is, with multiple processes or multiple threads or some combination.
For now, on Linux (and even UNIX)
you should only use the (default) prefork module with PHP.
This is specified at compile time.
Other MPM modules (any involving threads) break PHP.
This is partly because PHP uses a great number of external libraries,
and many or most of them are not thread-safe or thread-aware.
In any case,
Linux 2.4 doesn't handle threads efficiently yet&mdash;multiple processes are better
(this changes with Linux 2.6,
or RedHat 9 with 2.6 threads backported to Linux 2.4).
</p>

<p> &bull; <b><tt>API module structure `php5_module' in file . . . is garbled</tt></b></p>
If you get a message like this:
<br />
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
httpd: Syntax error on line 195 of /usr/local/apache/conf/httpd.conf: API module
structure `php5_module' in file /usr/local/apache/modules/libphp5.so is garbled
- perhaps this is not an Apache module DSO
</pre>
</td>
</tr>
</table>
</blockquote>
it's because your version of PHP wasn't built for
the version of Apache you are using
(For PHP 4, substitute <tt>php4_module</tt> . . . <tt>libphp4.so</tt>).
Recompile PHP in a "fresh" source directory
(where you haven't built PHP before) and make sure
<tt>--prefix</tt>, <tt>--with-config-file</tt> and <tt>--with-apxs2</tt>
points to the correct Apache directories you are using and
the <tt>libphp4.so</tt> file has been copied to your
<tt>/usr/local/apache/modules</tt> directory.

<p> &bull; <b><tt>PATH_INFO</tt></b></p>
<p>
Dan Fitzpatrick notes that he uses
PATH_INFO for many PHP scripts like <tt>/index.php/go/do/something</tt>
(where parameters are passed to PHP as "fake" subdirectories).
He received a <tt>404 Not Found</tt> errors with Apache
2 but not Apache 1.3.27. He had to add "<tt>AcceptPathInfo On</tt>"
to file <tt>httpd.conf</tt>.
For details, see
<a href="http://httpd.apache.org/docs-2.2/mod/core.html#acceptpathinfo">
http://httpd.apache.org/docs-2.2/mod/core.html#acceptpathinfo</a>
</p>

<p> &bull; <b>Using <tt>&lt;? &nbsp; ?&gt;</tt> style tags in addition to
<tt>&lt;?php &nbsp; ?&gt;</tt> style tags</b></p>
<p>
If you want to also use the old-style (or MS ASP-like) tags
<tt>&lt;?</tt> and <tt>?&gt;</tt>
then add this line to your
<tt>php.ini</tt> file.  This is the default starting with PHP 5:
<br />
<blockquote>
<table bgcolor="#ffffcc" border="0">
<tr>
<td>
<pre>
short_open_tag = On
</pre>
</td>
</tr>
</table>
</blockquote>
</p>

<p> &bull; <b>GD library now built-in PHP</b></p>
<p>
PHP 4.3.0 has gd built-in, just pass <tt>--with-gd</tt> to PHP configure.
</p>


<p> &bull; <b><tt>--with-apache</tt></b></p>
<p>
If you don't have Apache source at the default directory at
<tt>/usr/local/apache</tt>,
then use <tt>--with-apache=DIR</tt> with PHP configure,
where DIR is the root source directory,
This tells PHP where to look for the Apache source.
</p>

<p>
&bull;
<b>Redhat 9</b>
<br />
Apache 2 and PHP is built-in RedHat 9
(packages httpd 2.0.40, and php 4.2.2).
Apache is mostly under <tt>/usr/lib/httpd</tt>
and <tt>/usr/sbin/httpd</tt>.
PHP is at <tt>/usr/lib/httpd/modules/libphp4.so</tt>
For a complete file listing, type: <tt>rpm -ql httpd php</tt>
</p>


<p>
For RedHat 9,
PHP 4.3.1 gives a compiler errors with RedHat 9 similar to:
<tt>my_malloc.c:24: undefined reference to `errno'</tt>
<br />
The problem is with mysql and will have to wait for a fix from them.
Until then, add this line:
<br />
<tt>#include &lt;errno.h&gt;</tt>
<br />
to the beginning of
file <tt>./ext/mysql/libmysql/mysql.h</tt>
in your PHP source and remake PHP (from scratch).
</p>

<p>
&bull;
<b>Notes about Gentoo Linux and Apache2 with PHP</b>
</p>
<p>
<tt>LoadModule php5_module        modules/libphp5.so</tt>
<br />
becomes:
<br />
<tt>LoadModule php5_module        /usr/lib/apache2-extramodules/libphp5.so</tt>
</p>
<p>
To start automatically under Gentoo:
<br />
<tt>rc-update add apache2 default</tt>
<br />
(change <tt>php5</tt> to <tt>php4</tt> for PHP 4)
</p>
<p>
[Thanks to Phillip Temple]
</p>



<h2>
<img src="images/php.png" width="90" height="48" align="middle" border="0"
 alt="php logo">
<a id="references">References</a></h2>

<ul>
<li><b>Apache and PHP</b>
<li>
<a href="http://groups.google.com/groups?dq=&start=25&hl=en&lr=&ie=UTF-8&group=comp.lang.php&safe=off&selm=1b7cbdd3.0210181532.68d981cb%40posting.google.com">
Original posting</a>
on USENET newsgroup
<a href="news:comp.lang.php">comp.lang.php</a>,
<a href="http://groups.google.com/groups?dq=&start=25&hl=en&lr=&ie=UTF-8&group=comp.lang.php&safe=off&selm=1b7cbdd3.0210181532.68d981cb%40posting.google.com">
1b7cbdd3.0210181532.68d981cb%40posting.google.com</a>
<li>
<a href="http://www10.brinkster.com/ssruprai/comphp.asp">
"Compiling PHP 4 and Apache 2
 from source on Linux OS"</a>,
	a document similar to this one, with more details and options,
	by Sukhwinder Singh.

<li>
<a href="http://mpcon.org/apacheguide/">Install &amp; Configure Apache, PHP, JSP, Ruby on Rails, MySQL, PHPMyAdmin &amp; WordPress on Windows XP/2000</a>
<li>
<a href="http://www.onlamp.com/php/">OnLAMP.com</a>:
	Good source of PHP and Apache tutorials (O'Reilly)

<br /><br />
<li><b>Apache</b>
<li><a href="http://httpd.apache.org/">Apache httpd server website</a>:
	Links to documentation and source
	<ul>
	<li><a href="http://httpd.apache.org/docs-2.0/upgrading.html">
		How to upgrade from Apache 1.3 to 2.0</a>
	<li><a href="http://httpd.apache.org/docs-2.2/upgrading.html">
		How to upgrade from Apache 2.0 to 2.2</a>
	<li><a href="http://httpd.apache.org/docs-2.0/new_features_2_0.html">
		Why should you upgrade (Apache 2.0 features)</a>
	</ul>
<li><a href="http://www.europe.redhat.com/documentation/rhl8.0/rhl-rg-en-8.0/s1-httpd-v2-mig.php3">Migrating
		Apache HTTP Server 1.3 Configuration Files</a>
	(Redhat)
<li><a href="http://apache.slashdot.org/apache/02/09/09/209235.shtml?tid=148">Sites Reject Apache2</a>
	commentary on Slashdot about slow adoption of Apache 2 due to a lack
	of 3rd-party modules (9/2002).
<li><a href="http://www.apacheweek.com/">ApacheWeek</a> has the best updates
	on Apache development effort.
<li><a href="http://apache.slashdot.org/">Apache on Slashdot</a>
	also has news on Apache and related efforts.


<br /><br />
<li><b>PHP</b>
<li><a href="http://www.php.net/">PHP website</a>:
	Has links to documentation, source, mailing lists,
	and
	<a href="http://news.php.net/">news groups</a>
<li><a href="http://www.zend.com/zend/week/">PHP Weekly Summary</a>,
	is a good source on the latest PHP developments.
<li>
<a href="http://www.alt-php-faq.org/">PHP FAQ</a>:
Old, but still useful.
Note that the newsgroup has moved to USENET newsgroup
<a href="news:comp.lang.php">comp.lang.php</a>.
(also available at <a href="http://groups.google.com/groups?hl=en&lr=&ie=UTF-8&safe=off&group=comp.lang.php">Google Groups</a>)


<br /><br />
<li><b>PHP Security</b>
	<ul>
	<li>
	<a href="http://www.zend.com/zend/art/art-oertli.php">Secure Programming in PHP</a> by Thomas Oertli (Zend.com, 1/2002)
	<li>
	<a href="http://forums.devshed.com/showthread.php?threadid=20525&forumid=5">Security Notes</a> by JeffCT (DevShed.com, 1/2001)
	</ul>

</ul>



<p>
<h2>
<img src="images/php.png" width="90" height="48" align="middle" border="0"
 alt="php logo">
Copyright and Disclaimer</h2>
</p>

<p>
Copyright © 2002-2006 Dan Anderson.  All rights reserved.
</p>

<p class="small">
This document is provided "as is" in the hope that it will be useful, but
WITHOUT ANY WARRANTY, to the extent permitted by law; without even the
implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
SUCH DAMAGE.
</p>




<p>
<hr />
<a href="./">[Home]</a>
<font size="-1">
</p>

<p>
Last updated
Wednesday, 05-Sep-2007 09:21:52 PDT.
</p>


<p>
<address>
If you have questions or comments,
please send a message to
<a href="https://dan.drydog.com/comment.html">Dan Anderson</a>.
</address>
</p>

<p align="center">
http://dan.drydog.com/apache2php.html
</p>
</font>

</body>
</html>
